<div id="selected-neighbours-list" class="govuk-!-padding-bottom-5">
  <h2 class="govuk-heading-m">2) Check selected neighbours</h2>
  <p class="govuk-body">Add or remove neighbours before sending letters</p>
  <% if @consultation.neighbours.without_letters.any? %>
    <% @consultation.neighbours.without_letters.each do |neighbour| %>
      <hr>
      <div class="proposal-details-sub-heading" data-controller="edit-form">
        <div class="width-80 govuk-!-margin-top-1">
          <p class="govuk-body">
            <%= neighbour.address %>
          </p>
        </div>

        <%= form_with(
          model: [@planning_application, @consultation],
          builder: GOVUKDesignSystemFormBuilder::FormBuilder,
          data: { action: "submit->submit-form#handleSubmit" },
          url: planning_application_publicity_path(@planning_application, @consultation),
          class: "display-none"
        ) do |form| %>
          <%= form.govuk_error_summary(presenter: ErrorPresenter) %>
          <%= form.fields_for :neighbours, neighbour do |ff| %>
            <%= ff.govuk_text_field :address %>
            <%= ff.hidden_field :consultation_id, value: @consultation.id %>
          <% end %>
          <br>
          <%= form.submit(
            "Save",
            class: "govuk-button govuk-button--secondary"
          ) %>
        <% end %>

        <div class="neighbour-action-links">
          <%= link_to(
              "Edit",
              "#",
              class: "govuk-link",
              data: { action: "click->edit-form#handleClick" }
            ) 
          %>

          <%= link_to(
                "Remove",
                planning_application_publicity_path(
                    @planning_application,
                    @consultation,
                    neighbour: neighbour
                ),
                method: :delete,
                class: "govuk-link"
          ) %>
        </div>
      </div>
    <% end %>
  <% else %>
    <p class="govuk-body">No neighbours selected yet</p>
  <% end %>
</div>
