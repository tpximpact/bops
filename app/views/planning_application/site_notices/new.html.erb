<% content_for :page_title do %>
  Site notice - <%= t('page_title') %>
<% end %>

<% add_parent_breadcrumb_link "Home", root_path %>
<% add_parent_breadcrumb_link "Application", planning_application_path(@planning_application) %>
<% add_parent_breadcrumb_link "Consultations", planning_application_consultations_path(@planning_application) %>
<% content_for :title, "Site notice" %>

<%= render(
  partial: "shared/proposal_header",
  locals: { heading: "Send site notice" }
) %>

<% if @planning_application.site_notices.any? %>
  <hr>
  <div class="proposal-details-sub-heading govuk-!-margin-top-3 govuk-!-margin-bottom-3">
    <p class="govuk-body govuk-!-margin-top-1">
      <%= @planning_application.last_site_notice_audit.audit_comment %>
    </p>
    <div class="consultation-letter-status">
      <div>
        <%= render(StatusTags::BaseComponent.new(status: :complete)) %>
      </div>
      <p class="govuk-body-s govuk-!-margin-top-1 govuk-!-margin-bottom-0">
        on <%= @planning_application.last_site_notice_audit.created_at.to_fs(:day_month_year_slashes) %>
      </p>
    </div>
  </div>
  <hr>
<% end %>

<%= form_with(
  model: [@planning_application, @site_notice],
  builder: GOVUKDesignSystemFormBuilder::FormBuilder,
  class: "govuk-!-margin-top-5",
  method: :post
) do |form| %>
  <div data-controller="show-hide-form">
    <%= form.govuk_error_summary(presenter: ErrorPresenter) %>

    <%= form.govuk_radio_buttons_fieldset(
      :required,
      legend: { text: "Does this application require a site notice?", size: "m" }
    ) do %>
      <%= form.govuk_radio_button :required, :yes, label: { text: "Yes" }, data: { action: "change->show-hide-form#handleEvent" } %>
      <%= form.govuk_radio_button :required, :no, label: { text: "No" }, data: { action: "change->show-hide-form#handleEvent" } %>
    <% end %>

    <div class="display-none" id="site-notice-options">
      <div class="grey-box">
        <%= form.govuk_radio_buttons_fieldset(
          :method,
          legend: { text: "Email the site notice", size: "m" },
          hint: { text: "If you are printing the site notice yourself, you can skip this step." }
        ) do %>
          <%= form.govuk_radio_button :method, :internal_team, label: { text: "Send it by email to internal team to post" } do %>
            <%= form.govuk_text_field :internal_team_email, label: { text: "Internal team email" } %>
          <% end %>
          <%= form.govuk_radio_button :method, :applicant, label: { text: "Send it by email to applicant" } %>
        <% end %>

        <%= form.submit "Email site notice and mark as complete", class: "govuk-button govuk-button--primary govuk-!-margin-bottom-0" %>
      </div>

      <h3 class="govuk-heading-s">OR</h3>

      <div class="grey-box">
        <%= form.govuk_date_field :displayed_at, legend: { text: "Print the site notice" }, hint: { text: "Generate a PDF in a new tab from which you can print. Enter the date the site notice will be displayed" } %>

        <%= form.submit "Create PDF and mark as complete", class: "govuk-button govuk-button--primary govuk-!-margin-bottom-0", formtarget: "_blank" %>
      </div>

      <div class="govuk-button-group govuk-!-padding-top-7">
        <%= back_link %>
      </div>
    </div>

    <div class="govuk-button-group govuk-!-padding-top-7 display-none" id="site-notice-form-actions">
      <%= form.submit "Save and mark as complete", class: "govuk-button govuk-button--primary" %>

      <%= back_link %>
    </div>
  </div>
<% end %>
