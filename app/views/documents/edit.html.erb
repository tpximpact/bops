<% add_parent_breadcrumb_link "Home", planning_applications_path %>
<% add_parent_breadcrumb_link "Application", planning_application_path(@planning_application) %>
<% add_parent_breadcrumb_link "Documents", planning_application_documents_path(@planning_application) %>

<% content_for :title, "Edit document" %>

<div class="govuk-grid-row">
  <div class="govuk-grid-column-two-thirds">
    <h1 class="govuk-heading-l" style="margin-bottom: 7px;">
      <%= @planning_application.reference %>
    </h1>

    <p class="govuk-body">
      <%= @planning_application.site.full_address %>
    </p>

    <h2 class="govuk-heading-m"><%= @document.name %></h2>

    <%= link_to image_tag(@document.file.representation(resize: "500x500")),
                api_v1_planning_application_document_url(@planning_application, @document), target: :_blank %>
    <p class="govuk-body">
      <%= link_to "View in new window", api_v1_planning_application_document_url(@planning_application, @document), target: :_new %>
    </p>

    <%= form_with model: [ @planning_application, @document ], local: true do |form| %>
      <%= render partial: 'documents/form_partials/upload.html.erb', locals: {form: form} %>
      <div class="govuk-form-group <%= @document.errors[:numbers].any? ? 'govuk-form-group--error' : '' %>">
        <% if @document.errors[:numbers].any? %>
          <% @document.errors[:numbers].each do |error| %>
            <span id="status-error" class="govuk-error-message">
              <span class="govuk-visually-hidden">Error:</span><%= error %></span>
          <% end %>
        <% end %>
        <%= form.label :numbers, "Document number(s)", class: "govuk-label", for: "numbers" %>
        <div id="event-name-hint" class="govuk-hint">
          Please enter numbers for all documents you wish to appear on the decision notice. Do not add numbers for documents that should not be publicly available. Where documents contain multiple drawings, enter multiple numbers separated by a comma (e.g. "25A-V2, 25B-V2").
        </div>
        <%= form.text_area :numbers, class: "govuk-input govuk-input--width-20", id: "numbers" %>
      </div>

      <%= render partial: 'documents/form_partials/tags.html.erb', locals: {form: form} %>

      <div class="govuk-form-group">
        <%= form.submit "Save and return", class: "govuk-button", data: { module: "govuk-button" } %>
        <%= link_to 'Cancel', planning_application_documents_path(@planning_application), class: "govuk-button govuk-button--secondary" %>
      </div>
    <% end %>
  </div>
</div>
