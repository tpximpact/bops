<% content_for :page_title do %>
 <%= t(".assess_recommendation") %> - <%= t("page_title") %>
<% end %>
<% content_for(:title, t(".assess_recommendation")) %>
<%= render(
  layout: "planning_applications/assessment_dashboard",
  locals: { heading: t(".assess_recommendation") }
) do %>
  <%= render(
    partial: "legislation",
    locals: {
      planning_application: @planning_application,
      policy_classes: @planning_application.policy_classes
    }
  ) %>
  <%= render(
     partial: "events",
     locals: { recommendations: @planning_application.recommendations.reviewed }
  ) %>
  <%= render(
     partial: "documents",
     locals: {
       planning_application: @planning_application,
       documents: @planning_application.documents_for_decision_notice
     }
  ) %>
  <h2 class="govuk-heading-m"><%= t(".assess_recommendation") %></h2>
  <%= form_with(
    model: @recommendation,
    builder: GOVUKDesignSystemFormBuilder::FormBuilder,
    url: planning_application_recommendations_path(@planning_application)
  ) do |form| %>
    <%= form.govuk_error_summary(presenter: ErrorPresenter) %>
    <%= form.govuk_collection_radio_buttons(
      :decision,
      [[:granted, t(".yes")], [:refused, t(".no")]],
      :first,
      :last,
      legend: { text: t(".is_the_use"), size: "s" }
    ) %>
    <div class="govuk-form-group <%= "govuk-form-group--error" if form.object.errors[:public_comment].any? %>">
      <%= form.label(:public_comment, t(".state_the_reason"), class: "govuk-label govuk-label--s") %>
      <div class="govuk-hint"><%= t(".refer_to_the") %></div>
      <%= render(
        partial: "shared/warning_text",
        locals: { message: t(".this_information_will") }
      ) %>
      <% if form.object.errors[:public_comment].any? %>
        <p id="recommendation-form-public-comment-field-error" class="govuk-error-message">
          <span class="govuk-visually-hidden">
            <%= t(".error") %>
          </span>
          <%= form.object.errors[:public_comment].first %>
        </p>
      <% end %>
      <%= form.text_area(
        :public_comment,
        class: "govuk-textarea #{"govuk-textarea--error" if form.object.errors[:public_comment].any?}",
        rows: 9
      ) %>
    </div>
    <%= form.govuk_text_area(
      :assessor_comment,
      label: { text: t(".please_provide_supporting"), size: "s" },
      hint: { text: t(".this_information_will_not") },
      rows: 9
    ) %>
    <div class="govuk-button-group">
      <% if @planning_application.assessment_submitted? %>
        <%= form.govuk_submit(t(".update_assessment")) %>
      <% else %>
        <%= form.govuk_submit(t(".save_and_mark")) %>
        <%= form.submit(
          t(".save_and_come"),
          class: "govuk-button govuk-button--secondary",
          data: { module: "govuk-button" }
        ) %>
      <% end %>
      <%= link_to(
        t(".back"),
        planning_application_path(@planning_application),
        class: "govuk-button govuk-button--secondary"
      ) %>
    </div>
  <% end %>
<% end %>
