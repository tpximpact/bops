<my-map
  style="width: 100%; height: 400px;"
  osVectorTilesApiKey="VgqyKyGclwrFphAv4fw2MrpNI4CnzATT"
  showScale
  useScaleBarStyle
  <% if locals[:geojson].present? %>
    geojsonData='<%= locals[:geojson].is_a?(Hash) ? locals[:geojson].to_json : JSON.parse(locals[:geojson]).to_json.html_safe %>'
  <% elsif @planning_application.latitude && @planning_application.longitude %>
    zoom="19"
    latitude='<%= @planning_application.latitude %>'
    longitude='<%= @planning_application.longitude %>'
  <% end %>
  <% if locals[:geojson_field].present?  %>
    drawMode="true"
  <% end %>
></my-map>

<script>
  const map = document.querySelector("my-map");
  <% if locals[:geojson_field].present? %>
    map.addEventListener("geojsonChange", ({ detail: geoJSON }) => {
      document.getElementById("<%= locals[:geojson_field] %>").value = JSON.stringify(geoJSON);
    });
  <% end %>
  <% if locals[:in_accordion] == true %>
    function accordion_expanded() {
      window.dispatchEvent(new Event("resize"));
    }
  <% end %>
</script>