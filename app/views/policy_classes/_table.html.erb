<table class="govuk-table">
  <caption class="govuk-table__caption govuk-table__caption--l">
    <%= t(
      ".table_caption",
      part: policy_class.part,
      class: policy_class.section,
      name: policy_class.name
    ) %>
  </caption>
  <thead class="govuk-table__head">
    <tr class="govuk-table__row">
      <th scope="col" class="govuk-table__header govuk-!-width-one-half">
        <%= t(".policy_reference") %>
      </th>
      <th scope="col" class="govuk-table__header govuk-!-width-one-quarter-width">
        <%= t(".complies") %>
      </th>
      <th scope="col" class="govuk-table__header govuk-!-width-one-quarter-width">
        <%= t(".does_not_comply") %>
      </th>
      <th scope="col" class="govuk-table__header govuk-!-width-one-quarter-width">
        <%= t(".to_be_determined") %>
      </th>
    </tr>
  </thead>
  <tbody class="govuk-table__body">
    <%= form.fields_for(:policies, policies) do |policy_form| %>
      <tr class="govuk-table__row">
        <td class="govuk-table__cell">
          <h3 class="govuk-heading-s">
            <%= "#{form.object.section}.#{policy_form.object.section}" %>
          </h3>
          <p class="govuk-body">
            <%= simple_format(policy_form.object.description) %>
          </p>
          <% if editable %>
            <%= render(
              partial: "policy_classes/comment_form",
              locals: {
                planning_application: planning_application,
                policy_class: policy_class,
                policy: policy_form.object,
                comment: policy_form.object.existing_or_new_comment,
                policy_index: policy_form.options[:child_index]
              }
            ) %>
          <% elsif comment = policy_form.object.comment.presence %>
            <h4 class="govuk-heading-s policy-comment-title">
              <%=existing_policy_comment_label(comment)%>
            </h4>
            <p class="govuk-body"><%= simple_format(comment.text) %></p>
          <% end %>
        </td>
        <% Policy.statuses.each_key do |status| %>
          <td class="govuk-table__cell">
            <% if editable || policy_form.object.status == status %>
              <div class="govuk-form-group">
                <fieldset class="govuk-fieldset">
                  <div class="govuk-radios" data-module="govuk-radios">
                    <div class="govuk-radios govuk-radios--small">
                      <div class="govuk-radios__item">
                        <%= policy_form.radio_button(
                          :status,
                          status,
                          class: "govuk-radios__input",
                          disabled: planning_application.assessment_complete?
                        ) %>
                        <%= policy_form.label(
                          :status,
                          "&nbsp;".html_safe,
                          class: "govuk-label govuk-radios__label"
                        ) %>
                      </div>
                    </div>
                  </div>
                </fieldset>
              </div>
            <% end %>
          </td>
        <% end %>
      </tr>
    <% end %>
  </tbody>
</table>
