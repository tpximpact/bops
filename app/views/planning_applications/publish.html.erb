<% content_for :page_title do %>
  Publish the recommendation - <%= t('page_title') %>
<% end %>

<%= render "planning_applications/assessment_dashboard" do %>
  <% content_for :title, "Publish the recommendation" %>

    <h2 class="govuk-heading-m">Publish the recommendation</h2>
    <p class="govuk-body">The following decision notice was created based on the planning officer's recommendation and comment. Please review and publish it.</p>

  <%= render "decision_notice", planning_application: @planning_application %>
  <p class="govuk-body">
    <%= link_to "Download as PDF", decision_notice_api_v1_planning_application_path(@planning_application, format: 'pdf'), class: "govuk-link" %>
  </p>
  <% if @planning_application.awaiting_determination? %>
    <p class="govuk-body">By determining the application, the applicant will receive this decision notice. The decision notice will also be available publicly. </p>

    <%= form_with model: @planning_application,
      url: determine_planning_application_path(@planning_application),
      local: true,
      builder: GOVUKDesignSystemFormBuilder::FormBuilder do |form| %>

       <% if @planning_application.errors.any? %>
        <div class="govuk-error-summary" aria-labelledby="error-summary-title" role="alert" tabindex="-1" data-module="govuk-error-summary">
          <h2 class="govuk-error-summary__title" id="error-summary-title">
            There is a problem
          </h2>
          <div class="govuk-error-summary__body">
            <ul class="govuk-list govuk-error-summary__list">
              <% @planning_application.errors.each do |error| %>
                <li><%= error.message %></li>
              <% end %>
            </ul>
          </div>
        </div>
      <% end %>

      <%= form.govuk_date_field :determination_date, id: "determination-date" %>

      <%= form.submit "Determine application", class: "govuk-button" %>
    <% end %>
  <% else %>
    <%= link_to "Back", planning_application_path(@planning_application), class: "govuk-button" %>
  <% end %>
<% end%>
