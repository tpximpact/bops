<% content_for :page_title do %>
  Review and sign-off - <%= t("page_title") %>
<% end %>

<% add_parent_breadcrumb_link "Home", root_path %>
<% add_parent_breadcrumb_link "Application", planning_application_path(@planning_application) %>
<% content_for :title, t(".review_and_sign_off") %>

<%= render(
      partial: "shared/proposal_header",
      locals: {heading: t(".review_and_sign_off")}
    ) %>

<%= render "shared/dates_and_assignment_header" %>

<div class="govuk-grid-row">
  <div class="govuk-grid-column-full">
    <%= render(
          SiteMapComponent.new(
            planning_application: @planning_application
          )
        ) %>
  </div>
</div>

<div class="status-bar-container govuk-!-margin-bottom-0 govuk-!-margin-top-5" id="applicant-information-details">
  <div class="status-bar">
    <div class="status-panel" id="constraints">
      <h3 class="govuk-heading-s"><%= (@planning_application&.planning_application_constraints&.count.to_i > 0) ? @planning_application.planning_application_constraints.count : "Not identified" %></h3>
      <p class="govuk-body">Constraints</p>
    </div>
    <div class="status-panel" id="neighbours">
      <h3 class="govuk-heading-s"><%= (@planning_application&.consultation&.neighbour_responses&.count.to_i > 0) ? @planning_application.consultation.neighbour_responses.count : "Not identified" %></h3>
      <p class="govuk-body">Neighbour responses</p>
      <p class="govuk-body">
        <%= govuk_link_to "Show details", planning_application_consultation_neighbour_responses_path(@planning_application) %>
      </p>
    </div>
    <div class="status-panel" id="consultees">
      <h3 class="govuk-heading-s"><%= (@planning_application&.consultation&.consultees&.count.to_i > 0) ? @planning_application.consultation.consultees.count : "Not identified" %></h3>
      <p class="govuk-body">Consultee responses</p>
      <p class="govuk-body">
        <%= govuk_link_to "Show details", planning_application_consultees_responses_path(@planning_application) %>
      </p>
    </div>
    <div class="status-panel" id="documents">
      <h3 class="govuk-heading-s"><%= (@planning_application&.documents&.count.to_i > 0) ? @planning_application.documents.count : "Not identified" %></h3>
      <p class="govuk-body">Documents</p>
      <p class="govuk-body">
        <%= govuk_link_to "Show details", planning_application_documents_path(@planning_application) %>
      </p>
    </div>
  </div>
</div>

<% if @planning_application.application_type.consultation? %>
  <div class="govuk-grid-row">
    <div class="govuk-grid-column-full">
        <%= render "review_consultation" %>
    </div>
  </div>
<% end %>

<div class="govuk-grid-row">
  <div class="govuk-grid-column-full">
    <%= render "review_assessment" %>
  </div>
</div>

<div class="govuk-grid-row">
  <div class="govuk-grid-column-full">
    <%= render(Reviewing::Tasks::AfterSignOffComponent.new(planning_application: @planning_application)) %>
  </div>
</div>

<div class="govuk-grid-row">
  <div class="govuk-grid-column-full">
    <h2 class="govuk-heading-m govuk-!-margin-bottom-0 govuk-!-margin-top-5">
      <%= t(".application_details") %>
    </h2>

    <%= render(
          AccordionComponent.new(
            planning_application: @planning_application,
            sections: %w[application_information pre_assessment_outcome proposal_details]
          )
        ) %>
  </div>
</div>

<div class="govuk-grid-row">
  <div class="govuk-grid-column-full">
    <%= render(Reviewing::Tasks::ButtonGroupComponent.new(planning_application: @planning_application)) %>
  </div>
</div>
