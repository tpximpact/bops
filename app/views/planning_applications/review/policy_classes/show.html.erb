<% content_for :page_title do %>
  <%= t(".review") %> - <%= t("page_title") %>
<% end %>
<% add_parent_breadcrumb_link(t(".home"), planning_applications_path) %>
<% add_parent_breadcrumb_link(
     t(".application"),
     planning_application_path(@planning_application)
   ) %>
<% content_for(:title, t(".review")) %>

<%= render(
  partial: "shared/proposal_header",
  locals: { heading: t(".review_heading", part: @policy_class.part, class: @policy_class.section)  }
) %>

<div class="govuk-grid-row">
  <div class="govuk-grid-column-two-thirds">
    <h2 class="govuk-heading-m govuk-!-padding-bottom-3">
      <%= @policy_class.name.upcase_first %>
    </h2>
    <p class="govuk-body">
      <%= t(
            ".please_indicate_if",
            part: @policy_class.part,
            class: @policy_class.section
          ) %>
    </p>
    <p class="govuk-body">
      <%= link_to(
            t(".open_legislation_in"),
            @policy_class.url,
            class: "govuk-link",
            target: "_blank"
          ) %>
    </p>
  </div>
</div>

<div class="govuk-grid-row">
  <div class="govuk-grid-column-full">
    <%= form_with(
        model: [@planning_application, @policy_class],
        url: planning_application_review_policy_class_path(@planning_application, @policy_class),
        html: { data: unsaved_changes_data }
      ) do |form| %>
      <%= form.fields_for :review, @policy_class.review do |review_form| %>
        <fieldset class="govuk-fieldset">
          <div class="govuk-radios" data-module="govuk-radios">
            <%= review_form.govuk_radio_button :action, "accepted", label: { text: "Accept" }, checked: review_form.object.accepted?, disabled: true %>
            <%= review_form.govuk_radio_button :action, "rejected", label: { text: "Return to officer with comment" }, checked: review_form.object.rejected?, disabled: true do %>
              <%= review_form.govuk_text_area(
                :comment,
                label: { text: "Explain to the assessor why this needs reviewing" },
                rows: 6,
                disabled: true
              ) %>
            <% end %>
          </div>
        </fieldset>
      <% end %>
    <% end %>

    <div class="govuk-button-group">
      <%= back_link %>
      <%= link_to(
            "Edit review of Part #{@policy_class.part}, Class #{@policy_class.section}",
            edit_planning_application_review_policy_class_path(@policy_class.planning_application, @policy_class),
            class: "govuk-link"
          ) %>
    </div>
  </div>
</div>
