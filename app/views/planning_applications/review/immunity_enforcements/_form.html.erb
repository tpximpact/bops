<%= form_with model: [@planning_application, @review_immunity_detail],
              url: planning_application_review_immunity_enforcement_path(@planning_application, @review_immunity_detail),
              class: "govuk-!-margin-top-7" do |form| %>
  <%= form.govuk_error_summary(presenter: ErrorPresenter) %>

  <%= form.govuk_radio_buttons_fieldset(
    :accepted,
  ) do %>

    <% if @review_immunity_detail %>
      <p class="govuk-body">Assessor decision: <%= @review_immunity_detail.decision %></p>
      <p class="govuk-body">Reason: <%= @review_immunity_detail.decision_reason %></p>
      <p class="govuk-body">Summary: <%= @review_immunity_detail.summary %></p>
    <% end %>

    <%= form.govuk_radio_button(
      :accepted, true, disabled: !editable, checked: @review_immunity_detail.accepted && !@review_immunity_detail.reviewer_edited, label: { text: "Accept" }
    ) %>

    <%= form.govuk_radio_button(
      :accepted, true, disabled: !editable, checked: @review_immunity_detail.accepted && @review_immunity_detail.reviewer_edited, label: { text: "Edit to accept", id: "edit-to-accept" }
    ) do %>
      <%= form.govuk_text_area(
        :decision_reason, readonly: !editable, rows: 6, label: { text: "Update officer comment" }
      ) %>
    <% end %>

    <%= form.govuk_radio_button(
      :accepted, false, disabled: !editable, checked: !@review_immunity_detail.accepted && @review_immunity_detail.reviewer_comment?, label: { text: "Return to officer with comment" }
    ) do %>
      <%= form.govuk_text_area(
        :reviewer_comment, readonly: !editable, rows: 6
      ) %>
    <% end %>
  <% end %>

  <div class="govuk-button-group">
    <% if editable %>
      <%= form.submit "Save and mark as complete", class: "govuk-button", data: { module: "govuk-button" } %>
      <%= form.submit "Save and come back later", class: "govuk-button govuk-button--secondary", data: { module: "govuk-button" } %>
    <% end %>

    <%= back_link %>

    <% if !editable %>
      <%= link_to "Edit review immune from enforcement", edit_planning_application_review_immunity_enforcement_path(@planning_application, @review_immunity_detail), class: "govuk-link" %>
    <% end %>
  </div>
<% end %>
