<% content_for :page_title do %>
  Add informatives - <%= t("page_title") %>
<% end %>

<%= render(
      partial: "shared/assessment_task_breadcrumbs",
      locals: { planning_application: @planning_application }
    ) %>

<% content_for :title, "Add informatives" %>

<%= render(
      partial: "shared/proposal_header",
      locals: { heading: "Add informatives" }
    ) %>

<div class="govuk-grid-row" data-controller="informatives">
  <div class="govuk-grid-column-two-thirds">
    <% if @informative_set.informatives.select(&:persisted?).any? %>
      <% @informative_set.informatives.select(&:persisted?).each_with_index do |informative, index| %>
        <hr class="govuk-section-break govuk-section-break--l govuk-section-break--visible">
        <span class="govuk-hint">
          Informative <%= index +1 %>
        </span>
        <h2 class="govuk-heading-m">
          <%= informative.title %>
        </h2>
        <%= render(FormattedContentComponent.new(text: informative.text)) %>
        <%= link_to "Edit", edit_planning_application_assessment_informative_path(@planning_application, informative), class: "govuk-link" %>
        <%= link_to "Remove", planning_application_assessment_informative_path(@planning_application, informative), method: :delete, class: "govuk-link" %>
      <% end %>
    <% end %>
    <hr class="govuk-section-break govuk-section-break--l govuk-section-break--visible">

    <% if @informative_set.current_review&.complete? && params[:show_form] != "true" %>
      <%= link_to "+ Add informative", planning_application_assessment_informatives_path(@planning_application, show_form: true), class: "govuk-link govuk-body" %>
    <% end %>

    <div class="govuk-!-margin-top-8">
      <%= render "form", url: new_planning_application_assessment_informative_path(@planning_application), text: "Add informative" %>

      <div class="govuk-button-group">
        <% unless @informative_set.current_review&.complete? %>
          <%= link_to "Save and mark as complete", complete_planning_application_assessment_informatives_path(@planning_application), class: "govuk-button", method: :post %>
          <button class="govuk-button govuk-button--secondary" data-action="click->informatives#addInformative" type="button">
            Save and come back later
          </button>
        <% end %>
        <%= link_to "Back", planning_application_assessment_tasks_path(@planning_application), class: "govuk-button govuk-button--secondary" %>
      </div>
    </div>
  </div>
</div>
