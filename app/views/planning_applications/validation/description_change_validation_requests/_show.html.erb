<% content_for :page_title do %>
  Description change validation request - <%= t('page_title') %>
<% end %>

<% add_parent_breadcrumb_link "Home", root_path %>
<% add_parent_breadcrumb_link "Application", planning_application_path(@planning_application) %>
<% content_for :title, "Description change" %>

<div class="govuk-grid-row">
  <div class="govuk-grid-column-two-thirds">
    <h1 class="govuk-heading-l">
      Request approval to a description change
    </h1>
    <p class="govuk-body">
      <strong>At:</strong> <%= @planning_application.full_address  %> <br>
      <strong>Date received:</strong> <%= @planning_application.received_at.to_date.to_fs %> <br>
      <strong>Application number:</strong> <%= @planning_application.reference  %>
    </p>

    <div>
      <p class="govuk-body"> <strong> Previous description:</strong><br>
        <%= @validation_request.previous_description  %>
      </p>
      <p class="govuk-body"> <strong> Proposed description:</strong><br>
        <%= render(FormattedContentComponent.new(text: @validation_request.proposed_description)) %>
      </p>
    </div>
    <p class="govuk-body">
      <% if @validation_request.open? %>
        Sent on <%= @validation_request.created_at.to_date.to_fs %>. Agent or applicant has not yet responded.
      <% else %>
        <%= @validation_request.applicant_approved? ? 'Approved' : 'Rejected' %>
      <% end %>
    </p>

    <% if @validation_request.open? %>
      <%= form_with(
        model: [@planning_application, @validation_request],
        url: cancel_planning_application_validation_validation_request_path(
          @planning_application,
          @validation_request
        ),
        scope: :validation_request,
        method: :patch
      ) do |form| %>
        <%= form.hidden_field(:return_to, value: @back_path) %>
        <div class="govuk-button-group">
          <%= link_to(t(".back"), @back_path, class: "govuk-button") %>
          <%= form.submit(
            t(".cancel_this_request"),
            class: "govuk-button govuk-button--secondary"
          ) %>
        </div>
      <% end %>
    <% end %>
  </div>
</div>
