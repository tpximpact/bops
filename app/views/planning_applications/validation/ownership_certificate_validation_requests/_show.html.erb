<% content_for :page_title do %>
  Other validation request - <%= t('page_title') %>
<% end %>

<%= render "planning_applications/validation/validation_requests/validation_requests_breadcrumbs" %>
<% content_for :title, "Ownership certificate validation request" %>

<% if @validation_request.closed? %>
  <%= render(
    partial: "shared/proposal_header",
    locals: { heading: "Check the response to ownership certificate request" }
  ) %>
<% else %>
  <%= render(
    partial: "shared/proposal_header",
    locals: { heading: "View ownership certificate request" }
  ) %>
<% end %>

<div class="govuk-grid-row">
  <div class="govuk-grid-column-two-thirds">
    <p class="govuk-body">Certificate type: <%= @planning_application.ownership_certificate_type %></p>
    <h2 class="govuk-heading-m">Officer request</h2>
    <div class="govuk-inset-text">
      <p class="govuk-body">
        <strong>Reason it is invalid: </strong><%= render(FormattedContentComponent.new(text: @validation_request.reason)) %>
      </p>
      <p class="govuk-body">
        <strong>How it can be made valid: </strong><%= render(FormattedContentComponent.new(text: @validation_request.suggestion)) %>
      </p>
      <p class="govuk-body">
      <%= @validation_request.created_at.to_fs %>
      </p>
    </div>

      <% if @validation_request.closed? && @planning_application.invalidated?  %>
        <h2 class="govuk-heading-m">Applicant response</h2>
        <% if @validation_request.approved? %>
          <p class="govuk-body">Change to the ownership certificate has been approved by the applicant</p>
        <% elsif !@validation_request.approved? %>
          <p class="govuk-body">Applicant rejected this ownership certificate change</p>
          <p class="govuk-body">Reason: <%= @validation_request.rejection_reason.to_s  %></p>
        <% end %>


        <%= form_with model: @planning_application do |form| %>
          <%= render "shared/validation_request_show_actions",
            planning_application: @planning_application, validation_request: @validation_request, form: form %>
        <% end %>
      <% else %>
        <% if @planning_application.invalidated? %>
          <h2 class="govuk-heading-m">Applicant has not responded yet</h2>
        <% end %>

        <%= render "shared/validation_request_show_actions",
            planning_application: @planning_application, validation_request: @validation_request, form: nil %>
      <% end %>
  </div>
</div>
