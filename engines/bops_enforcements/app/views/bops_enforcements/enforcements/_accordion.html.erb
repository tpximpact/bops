<%= govuk_accordion do |accordion| %>
  <%= accordion.with_section(heading_text: "Breach report") do %>
  <%= govuk_table do |table| %>
      <% table.with_head do |head| %>
        <% head.with_row do |row| %>
          <% row.with_cell(text: "Question", classes: "govuk-!-width-one-half") %>
          <% row.with_cell(text: "Answer") %>
        <% end %>
      <% end %>
      <% table.with_body do |body| %>
          <% @enforcement.proposal_details.each_with_index do |proposal_detail, index| %>
        <% body.with_row do |row| %>
            <%= row.with_cell(text: "#{index + 1}. #{proposal_detail.question}") %>
            <%= row.with_cell(text: proposal_detail.response_values.join(", ").to_s, classes: "govuk-!-font-weight-bold") %>
          <% end %>
        <% end %>
      <% end %>
  <% end %>
<% end %>

  <%= accordion.with_section(heading_text: "Site location") do %>
    <p>This digital red line boundary was submitted by the complainant.</p>
    <%= render "shared/location_map", locals: {in_accordion: true, geojson: @enforcement.boundary_geojson} %>
  <% end %>

  <%= accordion.with_section(heading_text: "Complainant details") do %>
    <%= govuk_table do |table| %>
      <% table.with_head do |head| %>
        <% head.with_row do |row| %>
          <% row.with_cell(text: "Question", classes: "govuk-!-width-one-half") %>
          <% row.with_cell(text: "Answer") %>
        <% end %>
      <% end %>
      <% table.with_body do |body| %>
        <% body.with_row do |row| %>
          <%= row.with_cell(text: "Name") %>
          <%= row.with_cell(text: @enforcement.complainant.name, classes: "govuk-!-font-weight-bold") %>
        <% end %>
        <% body.with_row do |row| %>
          <%= row.with_cell(text: "Address") %>
          <%= row.with_cell(text: @enforcement.complainant.address, classes: "govuk-!-font-weight-bold") %>
        <% end %>
        <% body.with_row do |row| %>
          <%= row.with_cell(text: "Email") %>
          <%= row.with_cell(text: @enforcement.complainant.email, classes: "govuk-!-font-weight-bold") %>

        <% end %>
      <% end %>
    <% end %>
  <% end %>

  <%= accordion.with_section(heading_text: "Documents and Photos") do %>
  <div class="govuk-grid-row">
  <div class="govuk-grid-column-full" data-controller="download" data-application-reference-value="<%= @enforcement.case_record.id %>">
    <div id="check-tag-documents-tasks">
      <div data-download-target="documentsElement">
        <ul class="app-task-list__items govuk-!-padding-left-0">
          <% if @enforcement.case_record.documents.active.empty? %>
            <li id="check-supplied-document" class="app-task-list__item">
              <span class="app-task-list__task-name">
                There are no active documents
              </span>
            </li>
          <% else %>
            <div data-download-target="button" class="display-flex">
              <%= govuk_button_link_to "Download all documents", data: {action: "click->download#submit"}, secondary: true %>
            </div>

            <%= govuk_table(classes: "govuk-!-margin-top-4") do |table| %>
              <% table.with_head do |head| %>
                <% head.with_row do |row| %>
                  <% row.with_cell(text: "Document name") %>
                  <% row.with_cell(text: "Date received") %>
                  <% row.with_cell(text: "Visibility") %>
                <% end %>
              <% end %>

              <% table.with_body do |body| %>
                <% @enforcement.case_record.documents.active.each do |document| %>
                  <% next unless document.representable? %>
                  <% body.with_row(
                       html_attributes: {
                         "data-document-url-value" => url_for_document(document),
                         "data-document-title-value" => document.file.filename
                       }
                     ) do |row| %>
                    <%= row.with_cell do %>
                      <p><%= link_to_document(truncate(document.reference_or_name, length: 50), document) %></p>

                      <% if document.tags.present? %>
                        <% document.tags.each do |tag| %>
                          <strong class="govuk-tag govuk-tag--grey document-tag"><%= I18n.t(:"#{tag}", scope: :document_tags) %></strong>
                        <% end %>
                      <% else %>
                        <p class="govuk govuk-!-margin-bottom-1">
                          <em>No tags added</em>
                        </p>
                      <% end %>
                    <% end %>

                    <%= row.with_cell(text: document.received_at_or_created || "-") %>
                    <%= row.with_cell(text: document.publishable? ? "Public" : "Sensitive") %>
                  <% end %>
                <% end %>
              <% end %>
            <% end %>
          <% end %>
        </ul>
      </div>
    </div>
  </div>
</div>
  <% end %>
<% end %>
