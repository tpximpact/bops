name: Setup

runs:
  using: composite
  steps:
    - name: Install postgres client
      shell: bash
      run: |
        sudo apt-get -yqq install libpq-dev
    - name: Install gems
      shell: bash
      run: |
        gem install bundler -v 2.3.5
        bundle install --jobs 4 --retry 3 --path vendor/bundle
    - name: Setup database
      shell: bash
      env:
        DATABASE_URL: postgres://postgres:postgres@localhost:5432/test
        RAILS_ENV: test
        OTP_SECRET_ENCRYPTION_KEY: 83ccc50b-3ba9-45d9-8047-9518a935f065
      run: |
        bundle exec rake db:setup
